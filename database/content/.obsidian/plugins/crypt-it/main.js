/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => CryptItPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");

// inline-worker:__inline-worker
function inlineWorker(scriptText) {
  let blob = new Blob([scriptText], { type: "text/javascript" });
  let url = URL.createObjectURL(blob);
  let worker = new Worker(url);
  URL.revokeObjectURL(url);
  return worker;
}

// src/encrypt.worker.ts
function Worker2() {
  return inlineWorker('var Cn=Object.create;var se=Object.defineProperty;var jn=Object.getOwnPropertyDescriptor;var kn=Object.getOwnPropertyNames;var In=Object.getPrototypeOf,Mn=Object.prototype.hasOwnProperty;var On=(e,t)=>()=>(e&&(t=e(e=0)),t);var V=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Pn=(e,t)=>{for(var r in t)se(e,r,{get:t[r],enumerable:!0})},rr=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of kn(t))!Mn.call(e,s)&&s!==r&&se(e,s,{get:()=>t[s],enumerable:!(n=jn(t,s))||n.enumerable});return e};var Kn=(e,t,r)=>(r=e!=null?Cn(In(e)):{},rr(t||!e||!e.__esModule?se(r,"default",{value:e,enumerable:!0}):r,e)),Nn=e=>rr(se({},"__esModule",{value:!0}),e);var Ot=V(Y=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0});Y.output=Y.exists=Y.hash=Y.bytes=Y.bool=Y.number=Y.isBytes=void 0;function oe(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}Y.number=oe;function nr(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}Y.bool=nr;function sr(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}Y.isBytes=sr;function Ue(e,...t){if(!sr(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}Y.bytes=Ue;function or(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");oe(e.outputLen),oe(e.blockLen)}Y.hash=or;function ir(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}Y.exists=ir;function cr(e,t){Ue(e);let r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}Y.output=cr;var Hn={number:oe,bool:nr,bytes:Ue,hash:or,exists:ir,output:cr};Y.default=Hn});var fr=V(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});ie.crypto=void 0;ie.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0});var Pt=V(_=>{"use strict";Object.defineProperty(_,"__esModule",{value:!0});_.randomBytes=_.wrapXOFConstructorWithOpts=_.wrapConstructorWithOpts=_.wrapConstructor=_.checkOpts=_.Hash=_.concatBytes=_.toBytes=_.utf8ToBytes=_.asyncLoop=_.nextTick=_.hexToBytes=_.bytesToHex=_.byteSwap32=_.byteSwapIfBE=_.byteSwap=_.isLE=_.rotl=_.rotr=_.createView=_.u32=_.u8=_.isBytes=void 0;var Se=fr(),ve=Ot();function $n(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}_.isBytes=$n;var qn=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength);_.u8=qn;var Fn=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4));_.u32=Fn;var Rn=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);_.createView=Rn;var Dn=(e,t)=>e<<32-t|e>>>t;_.rotr=Dn;var zn=(e,t)=>e<<t|e>>>32-t>>>0;_.rotl=zn;_.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;var Vn=e=>e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255;_.byteSwap=Vn;_.byteSwapIfBE=_.isLE?e=>e:e=>(0,_.byteSwap)(e);function Wn(e){for(let t=0;t<e.length;t++)e[t]=(0,_.byteSwap)(e[t])}_.byteSwap32=Wn;var Gn=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Yn(e){(0,ve.bytes)(e);let t="";for(let r=0;r<e.length;r++)t+=Gn[e[r]];return t}_.bytesToHex=Yn;var ft={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function lr(e){if(e>=ft._0&&e<=ft._9)return e-ft._0;if(e>=ft._A&&e<=ft._F)return e-(ft._A-10);if(e>=ft._a&&e<=ft._f)return e-(ft._a-10)}function Zn(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);let t=e.length,r=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let s=0,o=0;s<r;s++,o+=2){let c=lr(e.charCodeAt(o)),i=lr(e.charCodeAt(o+1));if(c===void 0||i===void 0){let f=e[o]+e[o+1];throw new Error(\'hex string expected, got non-hex character "\'+f+\'" at index \'+o)}n[s]=c*16+i}return n}_.hexToBytes=Zn;var Xn=async()=>{};_.nextTick=Xn;async function Jn(e,t,r){let n=Date.now();for(let s=0;s<e;s++){r(s);let o=Date.now()-n;o>=0&&o<t||(await(0,_.nextTick)(),n+=o)}}_.asyncLoop=Jn;function ar(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}_.utf8ToBytes=ar;function ce(e){return typeof e=="string"&&(e=ar(e)),(0,ve.bytes)(e),e}_.toBytes=ce;function Qn(...e){let t=0;for(let n=0;n<e.length;n++){let s=e[n];(0,ve.bytes)(s),t+=s.length}let r=new Uint8Array(t);for(let n=0,s=0;n<e.length;n++){let o=e[n];r.set(o,s),s+=o.length}return r}_.concatBytes=Qn;var Le=class{clone(){return this._cloneInto()}};_.Hash=Le;var ts={}.toString;function es(e,t){if(t!==void 0&&ts.call(t)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(e,t)}_.checkOpts=es;function rs(e){let t=n=>e().update(ce(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}_.wrapConstructor=rs;function ns(e){let t=(n,s)=>e(s).update(ce(n)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=n=>e(n),t}_.wrapConstructorWithOpts=ns;function ss(e){let t=(n,s)=>e(s).update(ce(n)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=n=>e(n),t}_.wrapXOFConstructorWithOpts=ss;function os(e=32){if(Se.crypto&&typeof Se.crypto.getRandomValues=="function")return Se.crypto.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}_.randomBytes=os});var ur=V(dt=>{"use strict";Object.defineProperty(dt,"__esModule",{value:!0});dt.HashMD=dt.Maj=dt.Chi=void 0;var Te=Ot(),Zt=Pt();function is(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);let s=BigInt(32),o=BigInt(4294967295),c=Number(r>>s&o),i=Number(r&o),f=n?4:0,a=n?0:4;e.setUint32(t+f,c,n),e.setUint32(t+a,i,n)}var cs=(e,t,r)=>e&t^~e&r;dt.Chi=cs;var fs=(e,t,r)=>e&t^e&r^t&r;dt.Maj=fs;var Ce=class extends Zt.Hash{constructor(t,r,n,s){super(),this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=(0,Zt.createView)(this.buffer)}update(t){(0,Te.exists)(this);let{view:r,buffer:n,blockLen:s}=this;t=(0,Zt.toBytes)(t);let o=t.length;for(let c=0;c<o;){let i=Math.min(s-this.pos,o-c);if(i===s){let f=(0,Zt.createView)(t);for(;s<=o-c;c+=s)this.process(f,c);continue}n.set(t.subarray(c,c+i),this.pos),this.pos+=i,c+=i,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){(0,Te.exists)(this),(0,Te.output)(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:s,isLE:o}=this,{pos:c}=this;r[c++]=128,this.buffer.subarray(c).fill(0),this.padOffset>s-c&&(this.process(n,0),c=0);for(let u=c;u<s;u++)r[u]=0;is(n,s-8,BigInt(this.length*8),o),this.process(n,0);let i=(0,Zt.createView)(t),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let a=f/4,l=this.get();if(a>l.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<a;u++)i.setUint32(4*u,l[u],o)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:r,buffer:n,length:s,finished:o,destroyed:c,pos:i}=this;return t.length=s,t.pos=i,t.finished=o,t.destroyed=c,s%r&&t.buffer.set(n),t}};dt.HashMD=Ce});var hr=V(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.sha224=Kt.sha256=void 0;var je=ur(),tt=Pt(),ls=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),bt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),gt=new Uint32Array(64),fe=class extends je.HashMD{constructor(){super(64,32,8,!1),this.A=bt[0]|0,this.B=bt[1]|0,this.C=bt[2]|0,this.D=bt[3]|0,this.E=bt[4]|0,this.F=bt[5]|0,this.G=bt[6]|0,this.H=bt[7]|0}get(){let{A:t,B:r,C:n,D:s,E:o,F:c,G:i,H:f}=this;return[t,r,n,s,o,c,i,f]}set(t,r,n,s,o,c,i,f){this.A=t|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=o|0,this.F=c|0,this.G=i|0,this.H=f|0}process(t,r){for(let u=0;u<16;u++,r+=4)gt[u]=t.getUint32(r,!1);for(let u=16;u<64;u++){let d=gt[u-15],g=gt[u-2],y=(0,tt.rotr)(d,7)^(0,tt.rotr)(d,18)^d>>>3,h=(0,tt.rotr)(g,17)^(0,tt.rotr)(g,19)^g>>>10;gt[u]=h+gt[u-7]+y+gt[u-16]|0}let{A:n,B:s,C:o,D:c,E:i,F:f,G:a,H:l}=this;for(let u=0;u<64;u++){let d=(0,tt.rotr)(i,6)^(0,tt.rotr)(i,11)^(0,tt.rotr)(i,25),g=l+d+(0,je.Chi)(i,f,a)+ls[u]+gt[u]|0,h=((0,tt.rotr)(n,2)^(0,tt.rotr)(n,13)^(0,tt.rotr)(n,22))+(0,je.Maj)(n,s,o)|0;l=a,a=f,f=i,i=c+g|0,c=o,o=s,s=n,n=g+h|0}n=n+this.A|0,s=s+this.B|0,o=o+this.C|0,c=c+this.D|0,i=i+this.E|0,f=f+this.F|0,a=a+this.G|0,l=l+this.H|0,this.set(n,s,o,c,i,f,a,l)}roundClean(){gt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},ke=class extends fe{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}};Kt.sha256=(0,tt.wrapConstructor)(()=>new fe);Kt.sha224=(0,tt.wrapConstructor)(()=>new ke)});var dr=V(Bt=>{"use strict";Object.defineProperty(Bt,"__esModule",{value:!0});Bt.hmac=Bt.HMAC=void 0;var le=Ot(),yr=Pt(),Xt=class extends yr.Hash{constructor(t,r){super(),this.finished=!1,this.destroyed=!1,(0,le.hash)(t);let n=(0,yr.toBytes)(r);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let s=this.blockLen,o=new Uint8Array(s);o.set(n.length>s?t.create().update(n).digest():n);for(let c=0;c<o.length;c++)o[c]^=54;this.iHash.update(o),this.oHash=t.create();for(let c=0;c<o.length;c++)o[c]^=106;this.oHash.update(o),o.fill(0)}update(t){return(0,le.exists)(this),this.iHash.update(t),this}digestInto(t){(0,le.exists)(this),(0,le.bytes)(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:r,iHash:n,finished:s,destroyed:o,blockLen:c,outputLen:i}=this;return t=t,t.finished=s,t.destroyed=o,t.blockLen=c,t.outputLen=i,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};Bt.HMAC=Xt;var as=(e,t,r)=>new Xt(e,t).update(r).digest();Bt.hmac=as;Bt.hmac.create=(e,t)=>new Xt(e,t)});var pr=V(Ht=>{"use strict";Object.defineProperty(Ht,"__esModule",{value:!0});Ht.pbkdf2Async=Ht.pbkdf2=void 0;var ae=Ot(),us=dr(),Nt=Pt();function br(e,t,r,n){(0,ae.hash)(e);let s=(0,Nt.checkOpts)({dkLen:32,asyncTick:10},n),{c:o,dkLen:c,asyncTick:i}=s;if((0,ae.number)(o),(0,ae.number)(c),(0,ae.number)(i),o<1)throw new Error("PBKDF2: iterations (c) should be >= 1");let f=(0,Nt.toBytes)(t),a=(0,Nt.toBytes)(r),l=new Uint8Array(c),u=us.hmac.create(e,f),d=u._cloneInto().update(a);return{c:o,dkLen:c,asyncTick:i,DK:l,PRF:u,PRFSalt:d}}function gr(e,t,r,n,s){return e.destroy(),t.destroy(),n&&n.destroy(),s.fill(0),r}function hs(e,t,r,n){let{c:s,dkLen:o,DK:c,PRF:i,PRFSalt:f}=br(e,t,r,n),a,l=new Uint8Array(4),u=(0,Nt.createView)(l),d=new Uint8Array(i.outputLen);for(let g=1,y=0;y<o;g++,y+=i.outputLen){let h=c.subarray(y,y+i.outputLen);u.setInt32(0,g,!1),(a=f._cloneInto(a)).update(l).digestInto(d),h.set(d.subarray(0,h.length));for(let b=1;b<s;b++){i._cloneInto(a).update(d).digestInto(d);for(let p=0;p<h.length;p++)h[p]^=d[p]}}return gr(i,f,c,a,d)}Ht.pbkdf2=hs;async function ys(e,t,r,n){let{c:s,dkLen:o,asyncTick:c,DK:i,PRF:f,PRFSalt:a}=br(e,t,r,n),l,u=new Uint8Array(4),d=(0,Nt.createView)(u),g=new Uint8Array(f.outputLen);for(let y=1,h=0;h<o;y++,h+=f.outputLen){let b=i.subarray(h,h+f.outputLen);d.setInt32(0,y,!1),(l=a._cloneInto(l)).update(u).digestInto(g),b.set(g.subarray(0,b.length)),await(0,Nt.asyncLoop)(s-1,c,()=>{f._cloneInto(l).update(g).digestInto(g);for(let p=0;p<b.length;p++)b[p]^=g[p]})}return gr(f,a,i,l,g)}Ht.pbkdf2Async=ys});var Br=V(Ft=>{"use strict";Object.defineProperty(Ft,"__esModule",{value:!0});Ft.scryptAsync=Ft.scrypt=void 0;var $t=Ot(),xr=hr(),mr=pr(),A=Pt();function wr(e,t,r,n,s,o){let c=e[t++]^r[n++],i=e[t++]^r[n++],f=e[t++]^r[n++],a=e[t++]^r[n++],l=e[t++]^r[n++],u=e[t++]^r[n++],d=e[t++]^r[n++],g=e[t++]^r[n++],y=e[t++]^r[n++],h=e[t++]^r[n++],b=e[t++]^r[n++],p=e[t++]^r[n++],x=e[t++]^r[n++],S=e[t++]^r[n++],U=e[t++]^r[n++],v=e[t++]^r[n++],k=c,I=i,j=f,T=a,C=l,M=u,O=d,P=g,K=y,N=h,H=b,$=p,q=x,m=S,R=U,D=v;for(let F=0;F<8;F+=2)C^=(0,A.rotl)(k+q|0,7),K^=(0,A.rotl)(C+k|0,9),q^=(0,A.rotl)(K+C|0,13),k^=(0,A.rotl)(q+K|0,18),N^=(0,A.rotl)(M+I|0,7),m^=(0,A.rotl)(N+M|0,9),I^=(0,A.rotl)(m+N|0,13),M^=(0,A.rotl)(I+m|0,18),R^=(0,A.rotl)(H+O|0,7),j^=(0,A.rotl)(R+H|0,9),O^=(0,A.rotl)(j+R|0,13),H^=(0,A.rotl)(O+j|0,18),T^=(0,A.rotl)(D+$|0,7),P^=(0,A.rotl)(T+D|0,9),$^=(0,A.rotl)(P+T|0,13),D^=(0,A.rotl)($+P|0,18),I^=(0,A.rotl)(k+T|0,7),j^=(0,A.rotl)(I+k|0,9),T^=(0,A.rotl)(j+I|0,13),k^=(0,A.rotl)(T+j|0,18),O^=(0,A.rotl)(M+C|0,7),P^=(0,A.rotl)(O+M|0,9),C^=(0,A.rotl)(P+O|0,13),M^=(0,A.rotl)(C+P|0,18),$^=(0,A.rotl)(H+N|0,7),K^=(0,A.rotl)($+H|0,9),N^=(0,A.rotl)(K+$|0,13),H^=(0,A.rotl)(N+K|0,18),q^=(0,A.rotl)(D+R|0,7),m^=(0,A.rotl)(q+D|0,9),R^=(0,A.rotl)(m+q|0,13),D^=(0,A.rotl)(R+m|0,18);s[o++]=c+k|0,s[o++]=i+I|0,s[o++]=f+j|0,s[o++]=a+T|0,s[o++]=l+C|0,s[o++]=u+M|0,s[o++]=d+O|0,s[o++]=g+P|0,s[o++]=y+K|0,s[o++]=h+N|0,s[o++]=b+H|0,s[o++]=p+$|0,s[o++]=x+q|0,s[o++]=S+m|0,s[o++]=U+R|0,s[o++]=v+D|0}function qt(e,t,r,n,s){let o=n+0,c=n+16*s;for(let i=0;i<16;i++)r[c+i]=e[t+(2*s-1)*16+i];for(let i=0;i<s;i++,o+=16,t+=16)wr(r,c,e,t,r,o),i>0&&(c+=16),wr(r,o,e,t+=16,r,c)}function _r(e,t,r){let n=(0,A.checkOpts)({dkLen:32,asyncTick:10,maxmem:1073742848},r),{N:s,r:o,p:c,dkLen:i,asyncTick:f,maxmem:a,onProgress:l}=n;if((0,$t.number)(s),(0,$t.number)(o),(0,$t.number)(c),(0,$t.number)(i),(0,$t.number)(f),(0,$t.number)(a),l!==void 0&&typeof l!="function")throw new Error("progressCb should be function");let u=128*o,d=u/4;if(s<=1||s&s-1||s>=2**(u/8)||s>2**32)throw new Error("Scrypt: N must be larger than 1, a power of 2, less than 2^(128 * r / 8) and less than 2^32");if(c<0||c>(2**32-1)*32/u)throw new Error("Scrypt: p must be a positive integer less than or equal to ((2^32 - 1) * 32) / (128 * r)");if(i<0||i>(2**32-1)*32)throw new Error("Scrypt: dkLen should be positive integer less than or equal to (2^32 - 1) * 32");let g=u*(s+c);if(g>a)throw new Error(`Scrypt: parameters too large, ${g} (128 * r * (N + p)) > ${a} (maxmem)`);let y=(0,mr.pbkdf2)(xr.sha256,e,t,{c:1,dkLen:u*c}),h=(0,A.u32)(y),b=(0,A.u32)(new Uint8Array(u*s)),p=(0,A.u32)(new Uint8Array(u)),x=()=>{};if(l){let S=2*s*c,U=Math.max(Math.floor(S/1e4),1),v=0;x=()=>{v++,l&&(!(v%U)||v===S)&&l(v/S)}}return{N:s,r:o,p:c,dkLen:i,blockSize32:d,V:b,B32:h,B:y,tmp:p,blockMixCb:x,asyncTick:f}}function Er(e,t,r,n,s){let o=(0,mr.pbkdf2)(xr.sha256,e,r,{c:1,dkLen:t});return r.fill(0),n.fill(0),s.fill(0),o}function ds(e,t,r){let{N:n,r:s,p:o,dkLen:c,blockSize32:i,V:f,B32:a,B:l,tmp:u,blockMixCb:d}=_r(e,t,r);A.isLE||(0,A.byteSwap32)(a);for(let g=0;g<o;g++){let y=i*g;for(let h=0;h<i;h++)f[h]=a[y+h];for(let h=0,b=0;h<n-1;h++)qt(f,b,f,b+=i,s),d();qt(f,(n-1)*i,a,y,s),d();for(let h=0;h<n;h++){let b=a[y+i-16]%n;for(let p=0;p<i;p++)u[p]=a[y+p]^f[b*i+p];qt(u,0,a,y,s),d()}}return A.isLE||(0,A.byteSwap32)(a),Er(e,c,l,f,u)}Ft.scrypt=ds;async function bs(e,t,r){let{N:n,r:s,p:o,dkLen:c,blockSize32:i,V:f,B32:a,B:l,tmp:u,blockMixCb:d,asyncTick:g}=_r(e,t,r);A.isLE||(0,A.byteSwap32)(a);for(let y=0;y<o;y++){let h=i*y;for(let p=0;p<i;p++)f[p]=a[h+p];let b=0;await(0,A.asyncLoop)(n-1,g,()=>{qt(f,b,f,b+=i,s),d()}),qt(f,(n-1)*i,a,h,s),d(),await(0,A.asyncLoop)(n,g,()=>{let p=a[h+i-16]%n;for(let x=0;x<i;x++)u[x]=a[h+x]^f[p*i+x];qt(u,0,a,h,s),d()})}return A.isLE||(0,A.byteSwap32)(a),Er(e,c,l,f,u)}Ft.scryptAsync=bs});var lt=V(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.output=Z.exists=Z.hash=Z.bytes=Z.bool=Z.number=Z.isBytes=void 0;function ue(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}Z.number=ue;function Ar(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}Z.bool=Ar;function Ur(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}Z.isBytes=Ur;function Ie(e,...t){if(!Ur(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}Z.bytes=Ie;function Sr(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("hash must be wrapped by utils.wrapConstructor");ue(e.outputLen),ue(e.blockLen)}Z.hash=Sr;function Lr(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}Z.exists=Lr;function vr(e,t){Ie(e);let r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}Z.output=vr;var gs={number:ue,bool:Ar,bytes:Ie,hash:Sr,exists:Lr,output:vr};Z.default=gs});var At=V(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});B.u64Lengths=B.setBigUint64=B.wrapCipher=B.Hash=B.equalBytes=B.checkOpts=B.concatBytes=B.toBytes=B.bytesToUtf8=B.utf8ToBytes=B.asyncLoop=B.nextTick=B.numberToBytesBE=B.bytesToNumberBE=B.hexToNumber=B.hexToBytes=B.bytesToHex=B.isLE=B.createView=B.u32=B.u16=B.u8=void 0;var Pe=lt(),ps=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength);B.u8=ps;var ws=e=>new Uint16Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/2));B.u16=ws;var xs=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4));B.u32=xs;var ms=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);B.createView=ms;B.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!B.isLE)throw new Error("Non little-endian hardware is not supported");var _s=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Cr(e){(0,Pe.bytes)(e);let t="";for(let r=0;r<e.length;r++)t+=_s[e[r]];return t}B.bytesToHex=Cr;var at={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Tr(e){if(e>=at._0&&e<=at._9)return e-at._0;if(e>=at._A&&e<=at._F)return e-(at._A-10);if(e>=at._a&&e<=at._f)return e-(at._a-10)}function jr(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);let t=e.length,r=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let s=0,o=0;s<r;s++,o+=2){let c=Tr(e.charCodeAt(o)),i=Tr(e.charCodeAt(o+1));if(c===void 0||i===void 0){let f=e[o]+e[o+1];throw new Error(\'hex string expected, got non-hex character "\'+f+\'" at index \'+o)}n[s]=c*16+i}return n}B.hexToBytes=jr;function kr(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}B.hexToNumber=kr;function Es(e){return kr(Cr(e))}B.bytesToNumberBE=Es;function Bs(e,t){return jr(e.toString(16).padStart(t*2,"0"))}B.numberToBytesBE=Bs;var As=async()=>{};B.nextTick=As;async function Us(e,t,r){let n=Date.now();for(let s=0;s<e;s++){r(s);let o=Date.now()-n;o>=0&&o<t||(await(0,B.nextTick)(),n+=o)}}B.asyncLoop=Us;function Ir(e){if(typeof e!="string")throw new Error(`string expected, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}B.utf8ToBytes=Ir;function Ss(e){return new TextDecoder().decode(e)}B.bytesToUtf8=Ss;function Ls(e){if(typeof e=="string")e=Ir(e);else if((0,Pe.isBytes)(e))e=e.slice();else throw new Error(`Uint8Array expected, got ${typeof e}`);return e}B.toBytes=Ls;function vs(...e){let t=0;for(let n=0;n<e.length;n++){let s=e[n];(0,Pe.bytes)(s),t+=s.length}let r=new Uint8Array(t);for(let n=0,s=0;n<e.length;n++){let o=e[n];r.set(o,s),s+=o.length}return r}B.concatBytes=vs;function Ts(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}B.checkOpts=Ts;function Cs(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return r===0}B.equalBytes=Cs;var Me=class{};B.Hash=Me;var js=(e,t)=>(Object.assign(t,e),t);B.wrapCipher=js;function Oe(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);let s=BigInt(32),o=BigInt(4294967295),c=Number(r>>s&o),i=Number(r&o),f=n?4:0,a=n?0:4;e.setUint32(t+f,c,n),e.setUint32(t+a,i,n)}B.setBigUint64=Oe;function ks(e,t){let r=new Uint8Array(16),n=(0,B.createView)(r);return Oe(n,0,BigInt(t?t.length:0),!0),Oe(n,8,BigInt(e.length),!0),r}B.u64Lengths=ks});var Pr=V(Rt=>{"use strict";Object.defineProperty(Rt,"__esModule",{value:!0});Rt.createCipher=Rt.rotl=void 0;var ut=lt(),nt=At(),Is=(0,nt.utf8ToBytes)("expand 16-byte k"),Ms=(0,nt.utf8ToBytes)("expand 32-byte k"),Os=(0,nt.u32)(Is),Ps=(0,nt.u32)(Ms);function Ks(e,t){return e<<t|e>>>32-t}Rt.rotl=Ks;function Ke(e){return e.byteOffset%4===0}var he=64,Ns=16,Or=2**32-1,Mr=new Uint32Array;function Hs(e,t,r,n,s,o,c,i){let f=s.length,a=new Uint8Array(he),l=(0,nt.u32)(a),u=Ke(s)&&Ke(o),d=u?(0,nt.u32)(s):Mr,g=u?(0,nt.u32)(o):Mr;for(let y=0;y<f;c++){if(e(t,r,n,l,c,i),c>=Or)throw new Error("arx: counter overflow");let h=Math.min(he,f-y);if(u&&h===he){let b=y/4;if(y%4!==0)throw new Error("arx: invalid block position");for(let p=0,x;p<Ns;p++)x=b+p,g[x]=d[x]^l[p];y+=he;continue}for(let b=0,p;b<h;b++)p=y+b,o[p]=s[p]^a[b];y+=h}}function $s(e,t){let{allowShortKeys:r,extendNonceFn:n,counterLength:s,counterRight:o,rounds:c}=(0,nt.checkOpts)({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return(0,ut.number)(s),(0,ut.number)(c),(0,ut.bool)(o),(0,ut.bool)(r),(i,f,a,l,u=0)=>{(0,ut.bytes)(i),(0,ut.bytes)(f),(0,ut.bytes)(a);let d=a.length;if(l||(l=new Uint8Array(d)),(0,ut.bytes)(l),(0,ut.number)(u),u<0||u>=Or)throw new Error("arx: counter overflow");if(l.length<d)throw new Error(`arx: output (${l.length}) is shorter than data (${d})`);let g=[],y=i.length,h,b;if(y===32)h=i.slice(),g.push(h),b=Ps;else if(y===16&&r)h=new Uint8Array(32),h.set(i),h.set(i,16),b=Os,g.push(h);else throw new Error(`arx: invalid 32-byte key, got length=${y}`);Ke(f)||(f=f.slice(),g.push(f));let p=(0,nt.u32)(h);if(n){if(f.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(b,p,(0,nt.u32)(f.subarray(0,16)),p),f=f.subarray(16)}let x=16-s;if(x!==f.length)throw new Error(`arx: nonce must be ${x} or 16 bytes`);if(x!==12){let U=new Uint8Array(12);U.set(f,o?0:12-f.length),f=U,g.push(f)}let S=(0,nt.u32)(f);for(Hs(e,b,p,S,a,l,u,c);g.length>0;)g.pop().fill(0);return l}}Rt.createCipher=$s});var Nr=V(Dt=>{"use strict";Object.defineProperty(Dt,"__esModule",{value:!0});Dt.poly1305=Dt.wrapConstructorWithKey=void 0;var ye=lt(),Ne=At(),X=(e,t)=>e[t++]&255|(e[t++]&255)<<8,He=class{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=(0,Ne.toBytes)(t),(0,ye.bytes)(t,32);let r=X(t,0),n=X(t,2),s=X(t,4),o=X(t,6),c=X(t,8),i=X(t,10),f=X(t,12),a=X(t,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|s<<6)&7939,this.r[3]=(s>>>7|o<<9)&8191,this.r[4]=(o>>>4|c<<12)&255,this.r[5]=c>>>1&8190,this.r[6]=(c>>>14|i<<2)&8191,this.r[7]=(i>>>11|f<<5)&8065,this.r[8]=(f>>>8|a<<8)&8191,this.r[9]=a>>>5&127;for(let l=0;l<8;l++)this.pad[l]=X(t,16+2*l)}process(t,r,n=!1){let s=n?0:2048,{h:o,r:c}=this,i=c[0],f=c[1],a=c[2],l=c[3],u=c[4],d=c[5],g=c[6],y=c[7],h=c[8],b=c[9],p=X(t,r+0),x=X(t,r+2),S=X(t,r+4),U=X(t,r+6),v=X(t,r+8),k=X(t,r+10),I=X(t,r+12),j=X(t,r+14),T=o[0]+(p&8191),C=o[1]+((p>>>13|x<<3)&8191),M=o[2]+((x>>>10|S<<6)&8191),O=o[3]+((S>>>7|U<<9)&8191),P=o[4]+((U>>>4|v<<12)&8191),K=o[5]+(v>>>1&8191),N=o[6]+((v>>>14|k<<2)&8191),H=o[7]+((k>>>11|I<<5)&8191),$=o[8]+((I>>>8|j<<8)&8191),q=o[9]+(j>>>5|s),m=0,R=m+T*i+C*(5*b)+M*(5*h)+O*(5*y)+P*(5*g);m=R>>>13,R&=8191,R+=K*(5*d)+N*(5*u)+H*(5*l)+$*(5*a)+q*(5*f),m+=R>>>13,R&=8191;let D=m+T*f+C*i+M*(5*b)+O*(5*h)+P*(5*y);m=D>>>13,D&=8191,D+=K*(5*g)+N*(5*d)+H*(5*u)+$*(5*l)+q*(5*a),m+=D>>>13,D&=8191;let F=m+T*a+C*f+M*i+O*(5*b)+P*(5*h);m=F>>>13,F&=8191,F+=K*(5*y)+N*(5*g)+H*(5*d)+$*(5*u)+q*(5*l),m+=F>>>13,F&=8191;let ct=m+T*l+C*a+M*f+O*i+P*(5*b);m=ct>>>13,ct&=8191,ct+=K*(5*h)+N*(5*y)+H*(5*g)+$*(5*d)+q*(5*u),m+=ct>>>13,ct&=8191;let Tt=m+T*u+C*l+M*a+O*f+P*i;m=Tt>>>13,Tt&=8191,Tt+=K*(5*b)+N*(5*h)+H*(5*y)+$*(5*g)+q*(5*d),m+=Tt>>>13,Tt&=8191;let Ct=m+T*d+C*u+M*l+O*a+P*f;m=Ct>>>13,Ct&=8191,Ct+=K*i+N*(5*b)+H*(5*h)+$*(5*y)+q*(5*g),m+=Ct>>>13,Ct&=8191;let jt=m+T*g+C*d+M*u+O*l+P*a;m=jt>>>13,jt&=8191,jt+=K*f+N*i+H*(5*b)+$*(5*h)+q*(5*y),m+=jt>>>13,jt&=8191;let kt=m+T*y+C*g+M*d+O*u+P*l;m=kt>>>13,kt&=8191,kt+=K*a+N*f+H*i+$*(5*b)+q*(5*h),m+=kt>>>13,kt&=8191;let It=m+T*h+C*y+M*g+O*d+P*u;m=It>>>13,It&=8191,It+=K*l+N*a+H*f+$*i+q*(5*b),m+=It>>>13,It&=8191;let Mt=m+T*b+C*h+M*y+O*g+P*d;m=Mt>>>13,Mt&=8191,Mt+=K*u+N*l+H*a+$*f+q*i,m+=Mt>>>13,Mt&=8191,m=(m<<2)+m|0,m=m+R|0,R=m&8191,m=m>>>13,D+=m,o[0]=R,o[1]=D,o[2]=F,o[3]=ct,o[4]=Tt,o[5]=Ct,o[6]=jt,o[7]=kt,o[8]=It,o[9]=Mt}finalize(){let{h:t,pad:r}=this,n=new Uint16Array(10),s=t[1]>>>13;t[1]&=8191;for(let i=2;i<10;i++)t[i]+=s,s=t[i]>>>13,t[i]&=8191;t[0]+=s*5,s=t[0]>>>13,t[0]&=8191,t[1]+=s,s=t[1]>>>13,t[1]&=8191,t[2]+=s,n[0]=t[0]+5,s=n[0]>>>13,n[0]&=8191;for(let i=1;i<10;i++)n[i]=t[i]+s,s=n[i]>>>13,n[i]&=8191;n[9]-=8192;let o=(s^1)-1;for(let i=0;i<10;i++)n[i]&=o;o=~o;for(let i=0;i<10;i++)t[i]=t[i]&o|n[i];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let c=t[0]+r[0];t[0]=c&65535;for(let i=1;i<8;i++)c=(t[i]+r[i]|0)+(c>>>16)|0,t[i]=c&65535}update(t){(0,ye.exists)(this);let{buffer:r,blockLen:n}=this;t=(0,Ne.toBytes)(t);let s=t.length;for(let o=0;o<s;){let c=Math.min(n-this.pos,s-o);if(c===n){for(;n<=s-o;o+=n)this.process(t,o);continue}r.set(t.subarray(o,o+c),this.pos),this.pos+=c,o+=c,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(t){(0,ye.exists)(this),(0,ye.output)(t,this),this.finished=!0;let{buffer:r,h:n}=this,{pos:s}=this;if(s){for(r[s++]=1;s<16;s++)r[s]=0;this.process(r,0,!0)}this.finalize();let o=0;for(let c=0;c<8;c++)t[o++]=n[c]>>>0,t[o++]=n[c]>>>8;return t}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}};function Kr(e){let t=(n,s)=>e(s).update((0,Ne.toBytes)(n)).digest(),r=e(new Uint8Array(32));return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=n=>e(n),t}Dt.wrapConstructorWithKey=Kr;Dt.poly1305=Kr(e=>new He(e))});var Rr=V(J=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0});J.secretbox=J.xsalsa20poly1305=J.xsalsa20=J.salsa20=J.hsalsa=void 0;var Jt=lt(),w=Pr(),Hr=Nr(),$r=At();function qr(e,t,r,n,s,o=20){let c=e[0],i=t[0],f=t[1],a=t[2],l=t[3],u=e[1],d=r[0],g=r[1],y=s,h=0,b=e[2],p=t[4],x=t[5],S=t[6],U=t[7],v=e[3],k=c,I=i,j=f,T=a,C=l,M=u,O=d,P=g,K=y,N=h,H=b,$=p,q=x,m=S,R=U,D=v;for(let ct=0;ct<o;ct+=2)C^=(0,w.rotl)(k+q|0,7),K^=(0,w.rotl)(C+k|0,9),q^=(0,w.rotl)(K+C|0,13),k^=(0,w.rotl)(q+K|0,18),N^=(0,w.rotl)(M+I|0,7),m^=(0,w.rotl)(N+M|0,9),I^=(0,w.rotl)(m+N|0,13),M^=(0,w.rotl)(I+m|0,18),R^=(0,w.rotl)(H+O|0,7),j^=(0,w.rotl)(R+H|0,9),O^=(0,w.rotl)(j+R|0,13),H^=(0,w.rotl)(O+j|0,18),T^=(0,w.rotl)(D+$|0,7),P^=(0,w.rotl)(T+D|0,9),$^=(0,w.rotl)(P+T|0,13),D^=(0,w.rotl)($+P|0,18),I^=(0,w.rotl)(k+T|0,7),j^=(0,w.rotl)(I+k|0,9),T^=(0,w.rotl)(j+I|0,13),k^=(0,w.rotl)(T+j|0,18),O^=(0,w.rotl)(M+C|0,7),P^=(0,w.rotl)(O+M|0,9),C^=(0,w.rotl)(P+O|0,13),M^=(0,w.rotl)(C+P|0,18),$^=(0,w.rotl)(H+N|0,7),K^=(0,w.rotl)($+H|0,9),N^=(0,w.rotl)(K+$|0,13),H^=(0,w.rotl)(N+K|0,18),q^=(0,w.rotl)(D+R|0,7),m^=(0,w.rotl)(q+D|0,9),R^=(0,w.rotl)(m+q|0,13),D^=(0,w.rotl)(R+m|0,18);let F=0;n[F++]=c+k|0,n[F++]=i+I|0,n[F++]=f+j|0,n[F++]=a+T|0,n[F++]=l+C|0,n[F++]=u+M|0,n[F++]=d+O|0,n[F++]=g+P|0,n[F++]=y+K|0,n[F++]=h+N|0,n[F++]=b+H|0,n[F++]=p+$|0,n[F++]=x+q|0,n[F++]=S+m|0,n[F++]=U+R|0,n[F++]=v+D|0}function Fr(e,t,r,n){let s=e[0],o=t[0],c=t[1],i=t[2],f=t[3],a=e[1],l=r[0],u=r[1],d=r[2],g=r[3],y=e[2],h=t[4],b=t[5],p=t[6],x=t[7],S=e[3];for(let v=0;v<20;v+=2)f^=(0,w.rotl)(s+b|0,7),d^=(0,w.rotl)(f+s|0,9),b^=(0,w.rotl)(d+f|0,13),s^=(0,w.rotl)(b+d|0,18),g^=(0,w.rotl)(a+o|0,7),p^=(0,w.rotl)(g+a|0,9),o^=(0,w.rotl)(p+g|0,13),a^=(0,w.rotl)(o+p|0,18),x^=(0,w.rotl)(y+l|0,7),c^=(0,w.rotl)(x+y|0,9),l^=(0,w.rotl)(c+x|0,13),y^=(0,w.rotl)(l+c|0,18),i^=(0,w.rotl)(S+h|0,7),u^=(0,w.rotl)(i+S|0,9),h^=(0,w.rotl)(u+i|0,13),S^=(0,w.rotl)(h+u|0,18),o^=(0,w.rotl)(s+i|0,7),c^=(0,w.rotl)(o+s|0,9),i^=(0,w.rotl)(c+o|0,13),s^=(0,w.rotl)(i+c|0,18),l^=(0,w.rotl)(a+f|0,7),u^=(0,w.rotl)(l+a|0,9),f^=(0,w.rotl)(u+l|0,13),a^=(0,w.rotl)(f+u|0,18),h^=(0,w.rotl)(y+g|0,7),d^=(0,w.rotl)(h+y|0,9),g^=(0,w.rotl)(d+h|0,13),y^=(0,w.rotl)(g+d|0,18),b^=(0,w.rotl)(S+x|0,7),p^=(0,w.rotl)(b+S|0,9),x^=(0,w.rotl)(p+b|0,13),S^=(0,w.rotl)(x+p|0,18);let U=0;n[U++]=s,n[U++]=a,n[U++]=y,n[U++]=S,n[U++]=l,n[U++]=u,n[U++]=d,n[U++]=g}J.hsalsa=Fr;J.salsa20=(0,w.createCipher)(qr,{allowShortKeys:!0,counterRight:!0});J.xsalsa20=(0,w.createCipher)(qr,{counterRight:!0,extendNonceFn:Fr});J.xsalsa20poly1305=(0,$r.wrapCipher)({blockSize:64,nonceLength:24,tagLength:16},(e,t)=>((0,Jt.bytes)(e,32),(0,Jt.bytes)(t,24),{encrypt:(n,s)=>{(0,Jt.bytes)(n);let o=n.length+32;s?(0,Jt.bytes)(s,o):s=new Uint8Array(o),s.set(n,32),(0,J.xsalsa20)(e,t,s,s);let c=s.subarray(0,32),i=(0,Hr.poly1305)(s.subarray(32),c);return s.set(i,16),s.subarray(0,16).fill(0),s.subarray(16)},decrypt:n=>{(0,Jt.bytes)(n);let s=n.length;if(s<16)throw new Error("encrypted data should be at least 16 bytes");let o=new Uint8Array(s+16);o.set(n,16);let c=(0,J.xsalsa20)(e,t,new Uint8Array(32)),i=(0,Hr.poly1305)(o.subarray(32),c);if(!(0,$r.equalBytes)(o.subarray(16,32),i))throw new Error("invalid tag");let f=(0,J.xsalsa20)(e,t,o);return f.subarray(0,32).fill(0),c.fill(0),f.subarray(32)}}));function qs(e,t){let r=(0,J.xsalsa20poly1305)(e,t);return{seal:r.encrypt,open:r.decrypt}}J.secretbox=qs});var Dr=V(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.getWebcryptoSubtle=zt.randomBytes=void 0;var Ut=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Fs(e=32){if(Ut&&typeof Ut.getRandomValues=="function")return Ut.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}zt.randomBytes=Fs;function Rs(){if(Ut&&typeof Ut.subtle=="object"&&Ut.subtle!=null)return Ut.subtle;throw new Error("crypto.subtle must be defined")}zt.getWebcryptoSubtle=Rs});var zr=V(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.gcm=W.ctr=W.cbc=W.utils=W.managedNonce=W.getWebcryptoSubtle=W.randomBytes=void 0;var Qt=Dr();Object.defineProperty(W,"randomBytes",{enumerable:!0,get:function(){return Qt.randomBytes}});Object.defineProperty(W,"getWebcryptoSubtle",{enumerable:!0,get:function(){return Qt.getWebcryptoSubtle}});var Ds=At(),zs=lt(),de=lt();function Vs(e){return(0,zs.number)(e.nonceLength),(t,...r)=>({encrypt:(n,...s)=>{let{nonceLength:o}=e,c=(0,Qt.randomBytes)(o),i=e(t,c,...r).encrypt(n,...s),f=(0,Ds.concatBytes)(c,i);return i.fill(0),f},decrypt:(n,...s)=>{let{nonceLength:o}=e,c=n.subarray(0,o),i=n.subarray(o);return e(t,c,...r).decrypt(i,...s)}})}W.managedNonce=Vs;W.utils={async encrypt(e,t,r,n){let s=(0,Qt.getWebcryptoSubtle)(),o=await s.importKey("raw",e,t,!0,["encrypt"]),c=await s.encrypt(r,o,n);return new Uint8Array(c)},async decrypt(e,t,r,n){let s=(0,Qt.getWebcryptoSubtle)(),o=await s.importKey("raw",e,t,!0,["decrypt"]),c=await s.decrypt(r,o,n);return new Uint8Array(c)}};function Ws(e,t,r){if(e==="AES-CBC")return{name:"AES-CBC",iv:t};if(e==="AES-CTR")return{name:"AES-CTR",counter:t,length:64};if(e==="AES-GCM")return{name:"AES-GCM",iv:t,additionalData:r};throw new Error("unknown aes block mode")}function $e(e){return(t,r,n)=>{(0,de.bytes)(t),(0,de.bytes)(r);let s={name:e,length:t.length*8},o=Ws(e,r,n);return{encrypt(c){return(0,de.bytes)(c),W.utils.encrypt(t,s,o,c)},decrypt(c){return(0,de.bytes)(c),W.utils.decrypt(t,s,o,c)}}}}W.cbc=$e("AES-CBC");W.ctr=$e("AES-CTR");W.gcm=$e("AES-GCM")});var Wr=V((zo,Vr)=>{var Gs=16;function Ys(e,t){var r=e;if(typeof t!="number")t=Gs;else{if(t>255)throw new RangeError("pad(): PKCS#7 padding cannot be longer than 255 bytes");if(t<0)throw new RangeError("pad(): PKCS#7 padding size must be positive")}if(typeof e=="string"){var n=t-e.length%t;isNaN(n)&&(n=0);for(var s=String.fromCharCode(n),o=0;o<n;o++)r+=s}else if(e instanceof Uint8Array||e instanceof Uint8ClampedArray){var c=e.byteLength;n=t-c%t,isNaN(n)&&(n=0);var i=c+n;for(r=new e.constructor(i),r.set(e),o=c;o<i;o++)r[o]=n}else throw new TypeError("pad(): data could not be padded");return r}function Zs(e){var t=e;if(typeof e=="string"&&e.length>0){var r=e.charCodeAt(e.length-1);if(r>e.length)throw new Error("unpad(): cannot remove "+r+" bytes from a "+e.length+"-byte(s) string");for(var n=e.length-2,s=e.length-r;n>=s;n--)if(e.charCodeAt(n)!==r)throw new Error("unpad(): found a padding byte of "+e.charCodeAt(n)+" instead of "+r+" at position "+n);t=e.substring(0,s)}else if(e instanceof Uint8Array||e instanceof Uint8ClampedArray){var o=e.byteLength;r=e[o-1];var c=o-r;if(c<0)throw new Error("unpad(): cannot remove "+r+" bytes from a "+o+"-byte(s) string");for(n=o-2;n>=c;n--)if(e[n]!==r)throw new Error("unpad(): found a padding byte of "+e[n]+" instead of "+r+" at position "+n);t=e.slice(0,c)}return t}Vr.exports={pad:Ys,unpad:Zs}});var Zr=V(pt=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});pt.polyval=pt.ghash=pt._toGHASHKey=void 0;var st=At(),St=lt(),ht=16,Fe=new Uint8Array(16),ot=(0,st.u32)(Fe),Xs=225,Js=(e,t,r,n)=>{let s=n&1;return{s3:r<<31|n>>>1,s2:t<<31|r>>>1,s1:e<<31|t>>>1,s0:e>>>1^Xs<<24&-(s&1)}},et=e=>(e>>>0&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255|0;function Gr(e){e.reverse();let t=e[15]&1,r=0;for(let n=0;n<e.length;n++){let s=e[n];e[n]=s>>>1|r,r=(s&1)<<7}return e[0]^=-t&225,e}pt._toGHASHKey=Gr;var Qs=e=>e>64*1024?8:e>1024?4:2,be=class{constructor(t,r){this.blockLen=ht,this.outputLen=ht,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,t=(0,st.toBytes)(t),(0,St.bytes)(t,16);let n=(0,st.createView)(t),s=n.getUint32(0,!1),o=n.getUint32(4,!1),c=n.getUint32(8,!1),i=n.getUint32(12,!1),f=[];for(let y=0;y<128;y++)f.push({s0:et(s),s1:et(o),s2:et(c),s3:et(i)}),{s0:s,s1:o,s2:c,s3:i}=Js(s,o,c,i);let a=Qs(r||1024);if(![1,2,4,8].includes(a))throw new Error(`ghash: wrong window size=${a}, should be 2, 4 or 8`);this.W=a;let u=128/a,d=this.windowSize=2**a,g=[];for(let y=0;y<u;y++)for(let h=0;h<d;h++){let b=0,p=0,x=0,S=0;for(let U=0;U<a;U++){if(!(h>>>a-U-1&1))continue;let{s0:k,s1:I,s2:j,s3:T}=f[a*y+U];b^=k,p^=I,x^=j,S^=T}g.push({s0:b,s1:p,s2:x,s3:S})}this.t=g}_updateBlock(t,r,n,s){t^=this.s0,r^=this.s1,n^=this.s2,s^=this.s3;let{W:o,t:c,windowSize:i}=this,f=0,a=0,l=0,u=0,d=(1<<o)-1,g=0;for(let y of[t,r,n,s])for(let h=0;h<4;h++){let b=y>>>8*h&255;for(let p=8/o-1;p>=0;p--){let x=b>>>o*p&d,{s0:S,s1:U,s2:v,s3:k}=c[g*i+x];f^=S,a^=U,l^=v,u^=k,g+=1}}this.s0=f,this.s1=a,this.s2=l,this.s3=u}update(t){t=(0,st.toBytes)(t),(0,St.exists)(this);let r=(0,st.u32)(t),n=Math.floor(t.length/ht),s=t.length%ht;for(let o=0;o<n;o++)this._updateBlock(r[o*4+0],r[o*4+1],r[o*4+2],r[o*4+3]);return s&&(Fe.set(t.subarray(n*ht)),this._updateBlock(ot[0],ot[1],ot[2],ot[3]),ot.fill(0)),this}destroy(){let{t}=this;for(let r of t)r.s0=0,r.s1=0,r.s2=0,r.s3=0}digestInto(t){(0,St.exists)(this),(0,St.output)(t,this),this.finished=!0;let{s0:r,s1:n,s2:s,s3:o}=this,c=(0,st.u32)(t);return c[0]=r,c[1]=n,c[2]=s,c[3]=o,t}digest(){let t=new Uint8Array(ht);return this.digestInto(t),this.destroy(),t}},qe=class extends be{constructor(t,r){t=(0,st.toBytes)(t);let n=Gr(t.slice());super(n,r),n.fill(0)}update(t){t=(0,st.toBytes)(t),(0,St.exists)(this);let r=(0,st.u32)(t),n=t.length%ht,s=Math.floor(t.length/ht);for(let o=0;o<s;o++)this._updateBlock(et(r[o*4+3]),et(r[o*4+2]),et(r[o*4+1]),et(r[o*4+0]));return n&&(Fe.set(t.subarray(s*ht)),this._updateBlock(et(ot[3]),et(ot[2]),et(ot[1]),et(ot[0])),ot.fill(0)),this}digestInto(t){(0,St.exists)(this),(0,St.output)(t,this),this.finished=!0;let{s0:r,s1:n,s2:s,s3:o}=this,c=(0,st.u32)(t);return c[0]=r,c[1]=n,c[2]=s,c[3]=o,t.reverse()}};function Yr(e){let t=(n,s)=>e(s,n.length).update((0,st.toBytes)(n)).digest(),r=e(new Uint8Array(16),0);return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=(n,s)=>e(n,s),t}pt.ghash=Yr((e,t)=>new be(e,t));pt.polyval=Yr((e,t)=>new qe(e,t))});var fn=V(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.unsafe=G.siv=G.gcm=G.cbc=G.ecb=G.ctr=G.expandKeyDecLE=G.expandKeyLE=void 0;var L=At(),De=Zr(),z=lt(),Q=16,Xr=4,ge=new Uint8Array(Q),to=283;function Ve(e){return e<<1^to&-(e>>7)}function Vt(e,t){let r=0;for(;t>0;t>>=1)r^=e&-(t&1),e=Ve(e);return r}var ze=(()=>{let e=new Uint8Array(256);for(let r=0,n=1;r<256;r++,n^=Ve(n))e[r]=n;let t=new Uint8Array(256);t[0]=99;for(let r=0;r<255;r++){let n=e[255-r];n|=n<<8,t[e[r]]=(n^n>>4^n>>5^n>>6^n>>7^99)&255}return t})(),eo=ze.map((e,t)=>ze.indexOf(t)),ro=e=>e<<24|e>>>8,Re=e=>e<<8|e>>>24;function Jr(e,t){if(e.length!==256)throw new Error("Wrong sbox length");let r=new Uint32Array(256).map((a,l)=>t(e[l])),n=r.map(Re),s=n.map(Re),o=s.map(Re),c=new Uint32Array(256*256),i=new Uint32Array(256*256),f=new Uint16Array(256*256);for(let a=0;a<256;a++)for(let l=0;l<256;l++){let u=a*256+l;c[u]=r[a]^n[l],i[u]=s[a]^o[l],f[u]=e[a]<<8|e[l]}return{sbox:e,sbox2:f,T0:r,T1:n,T2:s,T3:o,T01:c,T23:i}}var We=Jr(ze,e=>Vt(e,3)<<24|e<<16|e<<8|Vt(e,2)),Qr=Jr(eo,e=>Vt(e,11)<<24|Vt(e,13)<<16|Vt(e,9)<<8|Vt(e,14)),no=(()=>{let e=new Uint8Array(16);for(let t=0,r=1;t<16;t++,r=Ve(r))e[t]=r;return e})();function yt(e){(0,z.bytes)(e);let t=e.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);let{sbox2:r}=We,n=(0,L.u32)(e),s=n.length,o=i=>it(r,i,i,i,i),c=new Uint32Array(t+28);c.set(n);for(let i=s;i<c.length;i++){let f=c[i-1];i%s===0?f=o(ro(f))^no[i/s-1]:s>6&&i%s===4&&(f=o(f)),c[i]=c[i-s]^f}return c}G.expandKeyLE=yt;function we(e){let t=yt(e),r=t.slice(),n=t.length,{sbox2:s}=We,{T0:o,T1:c,T2:i,T3:f}=Qr;for(let a=0;a<n;a+=4)for(let l=0;l<4;l++)r[a+l]=t[n-a-4+l];t.fill(0);for(let a=4;a<n-4;a++){let l=r[a],u=it(s,l,l,l,l);r[a]=o[u&255]^c[u>>>8&255]^i[u>>>16&255]^f[u>>>24]}return r}G.expandKeyDecLE=we;function wt(e,t,r,n,s,o){return e[r<<8&65280|n>>>8&255]^t[s>>>8&65280|o>>>24&255]}function it(e,t,r,n,s){return e[t&255|r&65280]|e[n>>>16&255|s>>>16&65280]<<16}function rt(e,t,r,n,s){let{sbox2:o,T01:c,T23:i}=We,f=0;t^=e[f++],r^=e[f++],n^=e[f++],s^=e[f++];let a=e.length/4-2;for(let y=0;y<a;y++){let h=e[f++]^wt(c,i,t,r,n,s),b=e[f++]^wt(c,i,r,n,s,t),p=e[f++]^wt(c,i,n,s,t,r),x=e[f++]^wt(c,i,s,t,r,n);t=h,r=b,n=p,s=x}let l=e[f++]^it(o,t,r,n,s),u=e[f++]^it(o,r,n,s,t),d=e[f++]^it(o,n,s,t,r),g=e[f++]^it(o,s,t,r,n);return{s0:l,s1:u,s2:d,s3:g}}function xe(e,t,r,n,s){let{sbox2:o,T01:c,T23:i}=Qr,f=0;t^=e[f++],r^=e[f++],n^=e[f++],s^=e[f++];let a=e.length/4-2;for(let y=0;y<a;y++){let h=e[f++]^wt(c,i,t,s,n,r),b=e[f++]^wt(c,i,r,t,s,n),p=e[f++]^wt(c,i,n,r,t,s),x=e[f++]^wt(c,i,s,n,r,t);t=h,r=b,n=p,s=x}let l=e[f++]^it(o,t,s,n,r),u=e[f++]^it(o,r,t,s,n),d=e[f++]^it(o,n,r,t,s),g=e[f++]^it(o,s,n,r,t);return{s0:l,s1:u,s2:d,s3:g}}function te(e,t){if(!t)return new Uint8Array(e);if((0,z.bytes)(t),t.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);return t}function tn(e,t,r,n){(0,z.bytes)(t,Q),(0,z.bytes)(r);let s=r.length;n=te(s,n);let o=t,c=(0,L.u32)(o),{s0:i,s1:f,s2:a,s3:l}=rt(e,c[0],c[1],c[2],c[3]),u=(0,L.u32)(r),d=(0,L.u32)(n);for(let y=0;y+4<=u.length;y+=4){d[y+0]=u[y+0]^i,d[y+1]=u[y+1]^f,d[y+2]=u[y+2]^a,d[y+3]=u[y+3]^l;let h=1;for(let b=o.length-1;b>=0;b--)h=h+(o[b]&255)|0,o[b]=h&255,h>>>=8;({s0:i,s1:f,s2:a,s3:l}=rt(e,c[0],c[1],c[2],c[3]))}let g=Q*Math.floor(u.length/Xr);if(g<s){let y=new Uint32Array([i,f,a,l]),h=(0,L.u8)(y);for(let b=g,p=0;b<s;b++,p++)n[b]=r[b]^h[p]}return n}function Wt(e,t,r,n,s){(0,z.bytes)(r,Q),(0,z.bytes)(n),s=te(n.length,s);let o=r,c=(0,L.u32)(o),i=(0,L.createView)(o),f=(0,L.u32)(n),a=(0,L.u32)(s),l=t?0:12,u=n.length,d=i.getUint32(l,t),{s0:g,s1:y,s2:h,s3:b}=rt(e,c[0],c[1],c[2],c[3]);for(let x=0;x+4<=f.length;x+=4)a[x+0]=f[x+0]^g,a[x+1]=f[x+1]^y,a[x+2]=f[x+2]^h,a[x+3]=f[x+3]^b,d=d+1>>>0,i.setUint32(l,d,t),{s0:g,s1:y,s2:h,s3:b}=rt(e,c[0],c[1],c[2],c[3]);let p=Q*Math.floor(f.length/Xr);if(p<u){let x=new Uint32Array([g,y,h,b]),S=(0,L.u8)(x);for(let U=p,v=0;U<u;U++,v++)s[U]=n[U]^S[v]}return s}G.ctr=(0,L.wrapCipher)({blockSize:16,nonceLength:16},function(t,r){(0,z.bytes)(t),(0,z.bytes)(r,Q);function n(s,o){let c=yt(t),i=r.slice(),f=tn(c,i,s,o);return c.fill(0),i.fill(0),f}return{encrypt:(s,o)=>n(s,o),decrypt:(s,o)=>n(s,o)}});function en(e){if((0,z.bytes)(e),e.length%Q!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${Q}`)}function rn(e,t,r){let n=e.length,s=n%Q;if(!t&&s!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");let o=(0,L.u32)(e);if(t){let f=Q-s;f||(f=Q),n=n+f}let c=te(n,r),i=(0,L.u32)(c);return{b:o,o:i,out:c}}function nn(e,t){if(!t)return e;let r=e.length;if(!r)throw new Error("aes/pcks5: empty ciphertext not allowed");let n=e[r-1];if(n<=0||n>16)throw new Error(`aes/pcks5: wrong padding byte: ${n}`);let s=e.subarray(0,-n);for(let o=0;o<n;o++)if(e[r-o-1]!==n)throw new Error("aes/pcks5: wrong padding");return s}function sn(e){let t=new Uint8Array(16),r=(0,L.u32)(t);t.set(e);let n=Q-e.length;for(let s=Q-n;s<Q;s++)t[s]=n;return r}G.ecb=(0,L.wrapCipher)({blockSize:16},function(t,r={}){(0,z.bytes)(t);let n=!r.disablePadding;return{encrypt:(s,o)=>{(0,z.bytes)(s);let{b:c,o:i,out:f}=rn(s,n,o),a=yt(t),l=0;for(;l+4<=c.length;){let{s0:u,s1:d,s2:g,s3:y}=rt(a,c[l+0],c[l+1],c[l+2],c[l+3]);i[l++]=u,i[l++]=d,i[l++]=g,i[l++]=y}if(n){let u=sn(s.subarray(l*4)),{s0:d,s1:g,s2:y,s3:h}=rt(a,u[0],u[1],u[2],u[3]);i[l++]=d,i[l++]=g,i[l++]=y,i[l++]=h}return a.fill(0),f},decrypt:(s,o)=>{en(s);let c=we(t),i=te(s.length,o),f=(0,L.u32)(s),a=(0,L.u32)(i);for(let l=0;l+4<=f.length;){let{s0:u,s1:d,s2:g,s3:y}=xe(c,f[l+0],f[l+1],f[l+2],f[l+3]);a[l++]=u,a[l++]=d,a[l++]=g,a[l++]=y}return c.fill(0),nn(i,n)}}});G.cbc=(0,L.wrapCipher)({blockSize:16,nonceLength:16},function(t,r,n={}){(0,z.bytes)(t),(0,z.bytes)(r,16);let s=!n.disablePadding;return{encrypt:(o,c)=>{let i=yt(t),{b:f,o:a,out:l}=rn(o,s,c),u=(0,L.u32)(r),d=u[0],g=u[1],y=u[2],h=u[3],b=0;for(;b+4<=f.length;)d^=f[b+0],g^=f[b+1],y^=f[b+2],h^=f[b+3],{s0:d,s1:g,s2:y,s3:h}=rt(i,d,g,y,h),a[b++]=d,a[b++]=g,a[b++]=y,a[b++]=h;if(s){let p=sn(o.subarray(b*4));d^=p[0],g^=p[1],y^=p[2],h^=p[3],{s0:d,s1:g,s2:y,s3:h}=rt(i,d,g,y,h),a[b++]=d,a[b++]=g,a[b++]=y,a[b++]=h}return i.fill(0),l},decrypt:(o,c)=>{en(o);let i=we(t),f=(0,L.u32)(r),a=te(o.length,c),l=(0,L.u32)(o),u=(0,L.u32)(a),d=f[0],g=f[1],y=f[2],h=f[3];for(let b=0;b+4<=l.length;){let p=d,x=g,S=y,U=h;d=l[b+0],g=l[b+1],y=l[b+2],h=l[b+3];let{s0:v,s1:k,s2:I,s3:j}=xe(i,d,g,y,h);u[b++]=v^p,u[b++]=k^x,u[b++]=I^S,u[b++]=j^U}return i.fill(0),nn(a,s)}}});function on(e,t,r,n,s){let o=e.create(r,n.length+((s==null?void 0:s.length)||0));s&&o.update(s),o.update(n);let c=new Uint8Array(16),i=(0,L.createView)(c);return s&&(0,L.setBigUint64)(i,0,BigInt(s.length*8),t),(0,L.setBigUint64)(i,8,BigInt(n.length*8),t),o.update(c),o.digest()}G.gcm=(0,L.wrapCipher)({blockSize:16,nonceLength:12,tagLength:16},function(t,r,n){if((0,z.bytes)(r),r.length===0)throw new Error("aes/gcm: empty nonce");let s=16;function o(i,f,a){let l=on(De.ghash,!1,i,a,n);for(let u=0;u<f.length;u++)l[u]^=f[u];return l}function c(){let i=yt(t),f=ge.slice(),a=ge.slice();if(Wt(i,!1,a,a,f),r.length===12)a.set(r);else{let u=ge.slice(),d=(0,L.createView)(u);(0,L.setBigUint64)(d,8,BigInt(r.length*8),!1),De.ghash.create(f).update(r).update(u).digestInto(a)}let l=Wt(i,!1,a,ge);return{xk:i,authKey:f,counter:a,tagMask:l}}return{encrypt:i=>{(0,z.bytes)(i);let{xk:f,authKey:a,counter:l,tagMask:u}=c(),d=new Uint8Array(i.length+s);Wt(f,!1,l,i,d);let g=o(a,u,d.subarray(0,d.length-s));return d.set(g,i.length),f.fill(0),d},decrypt:i=>{if((0,z.bytes)(i),i.length<s)throw new Error(`aes/gcm: ciphertext less than tagLen (${s})`);let{xk:f,authKey:a,counter:l,tagMask:u}=c(),d=i.subarray(0,-s),g=i.subarray(-s),y=o(a,u,d);if(!(0,L.equalBytes)(y,g))throw new Error("aes/gcm: invalid ghash tag");let h=Wt(f,!1,l,d);return a.fill(0),u.fill(0),f.fill(0),h}}});var pe=(e,t,r)=>n=>{if(!Number.isSafeInteger(n)||t>n||n>r)throw new Error(`${e}: invalid value=${n}, must be [${t}..${r}]`)};G.siv=(0,L.wrapCipher)({blockSize:16,nonceLength:12,tagLength:16},function(t,r,n){let o=pe("AAD",0,68719476736),c=pe("plaintext",0,2**36),i=pe("nonce",12,12),f=pe("ciphertext",16,2**36+16);(0,z.bytes)(r),i(r.length),n&&((0,z.bytes)(n),o(n.length));function a(){let d=t.length;if(d!==16&&d!==24&&d!==32)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${d} bytes`);let g=yt(t),y=new Uint8Array(d),h=new Uint8Array(16),b=(0,L.u32)(r),p=0,x=b[0],S=b[1],U=b[2],v=0;for(let k of[h,y].map(L.u32)){let I=(0,L.u32)(k);for(let j=0;j<I.length;j+=2){let{s0:T,s1:C}=rt(g,p,x,S,U);I[j+0]=T,I[j+1]=C,p=++v}}return g.fill(0),{authKey:h,encKey:yt(y)}}function l(d,g,y){let h=on(De.polyval,!0,g,y,n);for(let v=0;v<12;v++)h[v]^=r[v];h[15]&=127;let b=(0,L.u32)(h),p=b[0],x=b[1],S=b[2],U=b[3];return{s0:p,s1:x,s2:S,s3:U}=rt(d,p,x,S,U),b[0]=p,b[1]=x,b[2]=S,b[3]=U,h}function u(d,g,y){let h=g.slice();return h[15]|=128,Wt(d,!0,h,y)}return{encrypt:d=>{(0,z.bytes)(d),c(d.length);let{encKey:g,authKey:y}=a(),h=l(g,y,d),b=new Uint8Array(d.length+16);return b.set(h,d.length),b.set(u(g,h,d)),g.fill(0),y.fill(0),b},decrypt:d=>{(0,z.bytes)(d),f(d.length);let g=d.subarray(-16),{encKey:y,authKey:h}=a(),b=u(y,g,d.subarray(0,-16)),p=l(y,h,b);if(y.fill(0),h.fill(0),!(0,L.equalBytes)(g,p))throw new Error("invalid polyval tag");return b}}});function cn(e){return e!=null&&typeof e=="object"&&(e instanceof Uint32Array||e.constructor.name==="Uint32Array")}function so(e,t){if((0,z.bytes)(t,16),!cn(e))throw new Error("_encryptBlock accepts result of expandKeyLE");let r=(0,L.u32)(t),{s0:n,s1:s,s2:o,s3:c}=rt(e,r[0],r[1],r[2],r[3]);return r[0]=n,r[1]=s,r[2]=o,r[3]=c,t}function oo(e,t){if((0,z.bytes)(t,16),!cn(e))throw new Error("_decryptBlock accepts result of expandKeyLE");let r=(0,L.u32)(t),{s0:n,s1:s,s2:o,s3:c}=xe(e,r[0],r[1],r[2],r[3]);return r[0]=n,r[1]=s,r[2]=o,r[3]=c,t}G.unsafe={expandKeyLE:yt,expandKeyDecLE:we,encrypt:rt,decrypt:xe,encryptBlock:so,decryptBlock:oo,ctrCounter:tn,ctr32:Wt}});var hn=V(mt=>{"use strict";var Lt=mt&&mt.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(c){c(o)})}return new(r||(r=Promise))(function(o,c){function i(l){try{a(n.next(l))}catch(u){c(u)}}function f(l){try{a(n.throw(l))}catch(u){c(u)}}function a(l){l.done?o(l.value):s(l.value).then(i,f)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(mt,"__esModule",{value:!0});mt.AESCipherBlock=mt.EMECipher=void 0;var ln=fn();function un(e,t){if(t.length!==16)throw Error("len must be 16");let r=new Uint8Array(16);r[0]=2*t[0],t[15]>=128&&(r[0]=r[0]^135);for(let n=1;n<16;n++)r[n]=2*t[n],t[n-1]>=128&&(r[n]=r[n]+1);e.set(r)}function xt(e,t,r){if(t.length!==r.length)throw Error(`input1.length=${t.length} is not equal to input2.length=${r.length}`);for(let n=0;n<t.length;++n)e[n]=t[n]^r[n]}function Ge(e,t,r,n){return Lt(this,void 0,void 0,function*(){r?yield n.encrypt(e,t):yield n.decrypt(e,t)})}function io(e,t){return Lt(this,void 0,void 0,function*(){let r=new Uint8Array(16),n=new Uint8Array(16);yield e.encrypt(n,r);let s=new Array(t);for(let o=0;o<t;o++)un(n,n),s[o]=new Uint8Array(n);return s})}function an(e,t,r,n){return Lt(this,void 0,void 0,function*(){let s=t,o=r;if(e.blockSize()!==16)throw Error("Using a block size other than 16 is not implemented");if(s.length!==16)throw Error(`Tweak must be 16 bytes long, is ${s.length}`);if(o.length%16!==0)throw Error(`Data P must be a multiple of 16 long, is ${o.length}`);let c=o.length/16;if(c===0||c>16*8)throw Error(`EME operates on 1 to ${16*8} block-cipher blocks, you passed ${c}`);let i=new Uint8Array(o.length),f=yield io(e,c),a=new Uint8Array(16);for(let h=0;h<c;h++){let b=o.subarray(h*16,(h+1)*16);xt(a,b,f[h]),yield Ge(i.subarray(h*16,(h+1)*16),a,n,e)}let l=new Uint8Array(16);xt(l,i.subarray(0,16),s);for(let h=1;h<c;h++)xt(l,l,i.subarray(h*16,(h+1)*16));let u=new Uint8Array(16);yield Ge(u,l,n,e);let d=new Uint8Array(16);xt(d,l,u);let g=new Uint8Array(16);for(let h=1;h<c;h++)un(d,d),xt(g,i.subarray(h*16,(h+1)*16),d),i.subarray(h*16,(h+1)*16).set(g);let y=new Uint8Array(16);xt(y,u,s);for(let h=1;h<c;h++)xt(y,y,i.subarray(h*16,(h+1)*16));i.subarray(0,16).set(y);for(let h=0;h<c;h++)yield Ge(i.subarray(h*16,(h+1)*16),i.subarray(h*16,(h+1)*16),n,e),xt(i.subarray(h*16,(h+1)*16),i.subarray(h*16,(h+1)*16),f[h]);return i})}var Ye=class{constructor(t){this.bc=t}encrypt(t,r){return Lt(this,void 0,void 0,function*(){return yield an(this.bc,t,r,!0)})}decrypt(t,r){return Lt(this,void 0,void 0,function*(){return yield an(this.bc,t,r,!1)})}};mt.EMECipher=Ye;var Ze=class{constructor(t){if(this.keyRaw=t,this.iv=new Uint8Array(16),t.length===16)this.algo="aes128";else if(t.length===24)this.algo="aes192";else if(t.length===32)this.algo="aes256";else throw Error(`invalid key length = ${t.length}`)}encrypt(t,r){return Lt(this,void 0,void 0,function*(){let n=(0,ln.ecb)(this.keyRaw,{disablePadding:!0});t.set([...n.encrypt(r)])})}decrypt(t,r){return Lt(this,void 0,void 0,function*(){let n=(0,ln.ecb)(this.keyRaw,{disablePadding:!0});t.set([...n.decrypt(r)])})}blockSize(){return 16}};mt.AESCipherBlock=Ze});var wn=V(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});function Gt(e,t,r){var n;if(r===void 0&&(r={}),!t.codes){t.codes={};for(var s=0;s<t.chars.length;++s)t.codes[t.chars[s]]=s}if(!r.loose&&e.length*t.bits&7)throw new SyntaxError("Invalid padding");for(var o=e.length;e[o-1]==="=";)if(--o,!r.loose&&!((e.length-o)*t.bits&7))throw new SyntaxError("Invalid padding");for(var c=new((n=r.out)!=null?n:Uint8Array)(o*t.bits/8|0),i=0,f=0,a=0,l=0;l<o;++l){var u=t.codes[e[l]];if(u===void 0)throw new SyntaxError("Invalid character "+e[l]);f=f<<t.bits|u,i+=t.bits,i>=8&&(i-=8,c[a++]=255&f>>i)}if(i>=t.bits||255&f<<8-i)throw new SyntaxError("Unexpected end of data");return c}function Yt(e,t,r){r===void 0&&(r={});for(var n=r,s=n.pad,o=s===void 0?!0:s,c=(1<<t.bits)-1,i="",f=0,a=0,l=0;l<e.length;++l)for(a=a<<8|255&e[l],f+=8;f>t.bits;)f-=t.bits,i+=t.chars[c&a>>f];if(f&&(i+=t.chars[c&a<<t.bits-f]),o)for(;i.length*t.bits&7;)i+="=";return i}var yn={chars:"0123456789ABCDEF",bits:4},dn={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},bn={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},gn={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},pn={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},co={parse:function(t,r){return Gt(t.toUpperCase(),yn,r)},stringify:function(t,r){return Yt(t,yn,r)}},fo={parse:function(t,r){return r===void 0&&(r={}),Gt(r.loose?t.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):t,dn,r)},stringify:function(t,r){return Yt(t,dn,r)}},lo={parse:function(t,r){return Gt(t,bn,r)},stringify:function(t,r){return Yt(t,bn,r)}},ao={parse:function(t,r){return Gt(t,gn,r)},stringify:function(t,r){return Yt(t,gn,r)}},uo={parse:function(t,r){return Gt(t,pn,r)},stringify:function(t,r){return Yt(t,pn,r)}},ho={parse:Gt,stringify:Yt};_t.base16=co;_t.base32=fo;_t.base32hex=lo;_t.base64=ao;_t.base64url=uo;_t.codec=ho});var xn={};Pn(xn,{decode:()=>go,encode:()=>bo});var yo,me,Xe,bo,go,mn=On(()=>{yo=["\\u04A0\\u04BF\\u0500\\u051F\\u0680\\u06BF\\u0760\\u079F\\u07C0\\u07DF\\u1000\\u101F\\u10A0\\u10BF\\u1100\\u115F\\u1180\\u119F\\u11E0\\u123F\\u1260\\u127F\\u12E0\\u12FF\\u1320\\u133F\\u13A0\\u13DF\\u1420\\u165F\\u16A0\\u16DF\\u1780\\u179F\\u1820\\u185F\\u18C0\\u18DF\\u1980\\u199F\\u19E0\\u19FF\\u1A20\\u1A3F\\u1BC0\\u1BDF\\u1C00\\u1C1F\\u1D00\\u1D1F\\u21E0\\u21FF\\u22C0\\u22DF\\u2340\\u23DF\\u2400\\u241F\\u2500\\u275F\\u2780\\u27BF\\u2800\\u297F\\u29A0\\u29BF\\u2A20\\u2A5F\\u2A80\\u2ABF\\u2AE0\\u2B5F\\u2C00\\u2C1F\\u2C80\\u2CDF\\u2D00\\u2D1F\\u2D40\\u2D5F\\u2EA0\\u2EDF\\u31C0\\u31DF\\u3400\\u4D9F\\u4DC0\\u9FBF\\uA000\\uA47F\\uA4A0\\uA4BF\\uA500\\uA5FF\\uA640\\uA65F\\uA6A0\\uA6DF\\uA700\\uA75F\\uA780\\uA79F\\uA840\\uA85F","\\u0180\\u019F\\u0240\\u029F"],me={},Xe={};yo.forEach((e,t)=>{let r=[];e.match(/../gu).forEach(s=>{let o=s.codePointAt(0),c=s.codePointAt(1);for(let i=o;i<=c;i++)r.push(String.fromCodePoint(i))});let n=15-8*t;me[n]=r,r.forEach((s,o)=>{Xe[s]=[n,o]})});bo=e=>{let t=e.length,r="",n=0,s=0;for(let o=0;o<t;o++){let c=e[o];for(let i=7;i>=0;i--){let f=c>>i&1;n=(n<<1)+f,s++,s===15&&(r+=me[s][n],n=0,s=0)}}if(s!==0){for(;!(s in me);)n=(n<<1)+1,s++;r+=me[s][n]}return r},go=e=>{let t=e.length,r=new Uint8Array(Math.floor(t*15/8)),n=0,s=0,o=0;for(let c=0;c<t;c++){let i=e.charAt(c);if(!(i in Xe))throw new Error(`Unrecognised Base32768 character: ${i}`);let[f,a]=Xe[i];if(f!==15&&c!==t-1)throw new Error("Secondary character found before end of input at position "+String(c));for(let l=f-1;l>=0;l--){let u=a>>l&1;s=(s<<1)+u,o++,o===8&&(r[n]=s,n++,s=0,o=0)}}if(s!==(1<<o)-1)throw new Error("Padding mismatch");return new Uint8Array(r.buffer,0,n)}});var Tn=V(E=>{"use strict";var po=E&&E.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),wo=E&&E.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),xo=E&&E.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&po(t,e,r);return wo(t,e),t},vt=E&&E.__awaiter||function(e,t,r,n){function s(o){return o instanceof r?o:new r(function(c){c(o)})}return new(r||(r=Promise))(function(o,c){function i(l){try{a(n.next(l))}catch(u){c(u)}}function f(l){try{a(n.throw(l))}catch(u){c(u)}}function a(l){l.done?o(l.value):s(l.value).then(i,f)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(E,"__esModule",{value:!0});E.decryptedSize=E.encryptedSize=E.add=E.increment=E.carry=E.Cipher=E.msgErrorSuffixMissingDot=E.msgErrorBadSeek=E.msgErrorNotAnEncryptedFile=E.msgErrorFileClosed=E.msgErrorBadBase32Encoding=E.msgErrorEncryptedBadBlock=E.msgErrorEncryptedBadMagic=E.msgErrorEncryptedFileBadHeader=E.msgErrorEncryptedFileTooShort=E.msgErrorBadDecryptControlChar=E.msgErrorBadDecryptUTF8=void 0;var mo=Br(),Be=Rr(),_o=zr(),_n=Wr(),_e=hn(),Ee=wn(),En=xo((mn(),Nn(xn))),Eo=()=>(0,_o.randomBytes)(Be.xsalsa20poly1305.nonceLength),Bn=16,Un="RCLONE\\0\\0",An=new TextEncoder().encode(Un),ee=Un.length,Sn=24,re=ee+Sn,ne=Be.xsalsa20poly1305.tagLength,Et=64*1024,Ae=ne+Et,Bo=new Uint8Array([168,13,244,58,143,189,3,8,167,202,184,62,88,31,134,177]);E.msgErrorBadDecryptUTF8="bad decryption - utf-8 invalid";E.msgErrorBadDecryptControlChar="bad decryption - contains control chars";E.msgErrorEncryptedFileTooShort="file is too short to be encrypted";E.msgErrorEncryptedFileBadHeader="file has truncated block header";E.msgErrorEncryptedBadMagic="not an encrypted file - bad magic string";E.msgErrorEncryptedBadBlock="failed to authenticate decrypted block - bad password?";E.msgErrorBadBase32Encoding="bad base32 filename encoding";E.msgErrorFileClosed="file already closed";E.msgErrorNotAnEncryptedFile="not an encrypted file - does not match suffix";E.msgErrorBadSeek="Seek beyond end of file";E.msgErrorSuffixMissingDot="suffix config setting should include a \'.\'";var Je=class{constructor(t){this.dataKey=new Uint8Array(32),this.nameKey=new Uint8Array(32),this.nameTweak=new Uint8Array(Bn),this.dirNameEncrypt=!0,this.fileNameEnc=t}toString(){return`\ndataKey=${this.dataKey} \nnameKey=${this.nameKey}\nnameTweak=${this.nameTweak}\ndirNameEncrypt=${this.dirNameEncrypt}\nfileNameEnc=${this.fileNameEnc}\n`}encodeToString(t){if(this.fileNameEnc==="base32")return Ee.base32hex.stringify(t,{pad:!1}).toLowerCase();if(this.fileNameEnc==="base64")return Ee.base64url.stringify(t,{pad:!1});if(this.fileNameEnc==="base32768")return En.encode(t);throw Error(`unknown fileNameEnc=${this.fileNameEnc}`)}decodeString(t){if(this.fileNameEnc==="base32"){if(t.endsWith("="))throw new Error(E.msgErrorBadBase32Encoding);return Ee.base32hex.parse(t.toUpperCase(),{loose:!0})}else{if(this.fileNameEnc==="base64")return Ee.base64url.parse(t,{loose:!0});if(this.fileNameEnc==="base32768")return En.decode(t);throw Error(`unknown fileNameEnc=${this.fileNameEnc}`)}}key(t,r){return vt(this,void 0,void 0,function*(){let n=this.dataKey.length+this.nameKey.length+this.nameTweak.length,s=Bo;r!==""&&(s=new TextEncoder().encode(r));let o;return t===""?o=new Uint8Array(n):o=yield(0,mo.scryptAsync)(new TextEncoder().encode(t),s,{N:2**14,r:8,p:1,dkLen:n}),this.dataKey.set(o.slice(0,this.dataKey.length)),this.nameKey.set(o.slice(this.dataKey.length,this.dataKey.length+this.nameKey.length)),this.nameTweak.set(o.slice(this.dataKey.length+this.nameKey.length)),this})}encryptSegment(t){return vt(this,void 0,void 0,function*(){if(t==="")return"";let r=(0,_n.pad)(new TextEncoder().encode(t),Bn),n=new _e.AESCipherBlock(this.nameKey),o=yield new _e.EMECipher(n).encrypt(this.nameTweak,r);return this.encodeToString(o)})}encryptFileName(t){return vt(this,void 0,void 0,function*(){let r=t.split("/");for(let n=0;n<r.length;++n)!this.dirNameEncrypt&&n!==r.length-1||(r[n]=yield this.encryptSegment(r[n]));return r.join("/")})}decryptSegment(t){return vt(this,void 0,void 0,function*(){if(t==="")return"";let r=this.decodeString(t),n=new _e.AESCipherBlock(this.nameKey),o=yield new _e.EMECipher(n).decrypt(this.nameTweak,r),c=(0,_n.unpad)(o);return new TextDecoder().decode(c)})}decryptFileName(t){return vt(this,void 0,void 0,function*(){let r=t.split("/");for(let n=0;n<r.length;++n)!this.dirNameEncrypt&&n!==r.length-1||(r[n]=yield this.decryptSegment(r[n]));return r.join("/")})}encryptData(t,r){return vt(this,void 0,void 0,function*(){let n;r!==void 0?n=r:n=Eo();let s=new Uint8Array(Ln(t.byteLength));s.set(An),s.set(n,ee);for(let o=0,c=0;o<t.byteLength;o+=Et,c+=1){let i=t.slice(o,o+Et),f=(0,Be.xsalsa20poly1305)(this.dataKey,n).encrypt(i);Qe(n),s.set(f,ee+Sn+o+c*ne)}return s})}decryptData(t){return vt(this,void 0,void 0,function*(){if(t.byteLength<re)throw Error(E.msgErrorEncryptedFileTooShort);if(!Uo(t.slice(0,ee),An))throw Error(E.msgErrorEncryptedBadMagic);let r=t.slice(ee,re),n=new Uint8Array(vn(t.byteLength));for(let s=re,o=0,c=0;s<t.byteLength;s+=Ae,o+=Et,c+=1){let i=t.slice(s,s+Ae),f=(0,Be.xsalsa20poly1305)(this.dataKey,r).decrypt(i);if(f===null)throw Error(E.msgErrorEncryptedBadBlock);Qe(r),n.set(f,o)}return n})}};E.Cipher=Je;function tr(e,t){for(;e<t.length;e++){let r=t[e],n=r+1&255;if(t[e]=n,n>=r)break}}E.carry=tr;function Qe(e){return tr(0,e)}E.increment=Qe;function Ao(e,t){let r=BigInt(0);typeof e=="bigint"?r=BigInt.asUintN(64,e):typeof e=="number"&&(r=BigInt.asUintN(64,BigInt(e)));let n=BigInt.asUintN(16,BigInt(0));for(let s=0;s<8;s++){let o=t[s],c=r&BigInt(255);r>>=BigInt(8),n=n+BigInt(o)+BigInt(c),t[s]=Number(n),n>>=BigInt(8)}n!==BigInt(0)&&tr(8,t)}E.add=Ao;function Uo(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}function Ln(e){let t=Math.floor(e/Et),r=e%Et,n=re+t*(ne+Et);return r!==0&&(n+=ne+r),n}E.encryptedSize=Ln;function vn(e){let t=e;if(t-=re,t<0)throw new Error(E.msgErrorEncryptedFileTooShort);let r=Math.floor(t/Ae),n=t%Ae,s=r*Et;if(n!==0&&(n-=ne,n<=0))throw new Error(E.msgErrorEncryptedFileBadHeader);return s+=n,s}E.decryptedSize=vn});var er=Kn(Tn()),So=self;async function Lo(e,t){let r=new er.Cipher("base32");return await r.key(t,""),await r.encryptData(new Uint8Array(e),void 0)}async function vo(e,t){let r=new er.Cipher("base32");await r.key(t,"");try{return await r.decryptData(new Uint8Array(e))}catch(n){throw console.log(n),new Error("Could not decrypt message")}}So.addEventListener("message",async e=>{let t=e.ports[0],{input:r,password:n,action:s}=e.data;switch(s){case"encrypt":{let o=await Lo(r,n);t.postMessage({output:o},[o.buffer]);break}case"decrypt":{try{let o=await vo(r,n);t.postMessage({status:"ok",output:o},[o.buffer])}catch(o){console.error(o),t.postMessage({status:"error"})}break}default:break}});\n/*! Bundled license information:\n\n@noble/hashes/utils.js:\n  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)\n\n@noble/ciphers/utils.js:\n  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)\n*/\n');
}

// src/main.ts
async function encryptionByCallingWorker(worker, app, filePath, password) {
  new import_obsidian.Notice(`Encrypting ${filePath}`);
  const input = await app.vault.adapter.readBinary(filePath);
  const channel = new MessageChannel();
  worker.postMessage(
    {
      action: "encrypt",
      input,
      password
    },
    [channel.port1, input]
  );
  channel.port2.onmessage = async (event) => {
    const { output } = event.data;
    await app.vault.adapter.writeBinary(filePath + ".bin", output);
    new import_obsidian.Notice(`Finish encrypting ${filePath}`);
  };
}
async function decryptionByCallingWorker(worker, app, filePath, password) {
  new import_obsidian.Notice(`Decrypting ${filePath}`);
  const input = await app.vault.adapter.readBinary(filePath);
  const channel = new MessageChannel();
  worker.postMessage(
    {
      action: "decrypt",
      input,
      password
    },
    [channel.port1, input]
  );
  channel.port2.onmessage = async (event) => {
    const { output, status } = event.data;
    if (status === "error") {
      new import_obsidian.Notice(`Fail to decrypt.`);
      return;
    }
    const origFilePath = filePath.replace(/\.bin$/g, "");
    const origFilePathExt = origFilePath.split(".").pop();
    const newFileName = `${origFilePath.substring(
      0,
      origFilePath.length - origFilePathExt.length - 1
    )}.dec.${origFilePathExt}`;
    if (await app.vault.adapter.exists(newFileName)) {
      new import_obsidian.Notice(`${newFileName} already exists, not overwriting.`);
      return;
    }
    await app.vault.adapter.writeBinary(newFileName, output);
    new import_obsidian.Notice(`Finish decrypting ${filePath}`);
  };
}
var CryptItPlugin = class extends import_obsidian.Plugin {
  async onload() {
    this.worker = new Worker2();
    this.addCommand({
      id: "crypt-the-current-loading-file",
      name: "Crypt the current loading file",
      checkCallback: (checking) => {
        const markdownView = this.app.workspace.getActiveViewOfType(import_obsidian.MarkdownView);
        if (markdownView) {
          if (!checking) {
            const filePath = markdownView.file.path;
            new AskingPasswordModal(this.app, filePath, (result) => {
              encryptionByCallingWorker(
                this.worker,
                this.app,
                filePath,
                result
              );
            }).open();
          }
          return true;
        }
        return false;
      }
    });
    this.registerEvent(
      this.app.workspace.on("file-menu", (menu, file) => {
        if (file instanceof import_obsidian.TFolder) {
          return;
        }
        if (file.path.endsWith(".bin")) {
          return;
        }
        menu.addItem((item) => {
          item.setTitle("Generate encrypted version!").setIcon("lock").onClick(async () => {
            const filePath = file.path;
            new AskingPasswordModal(this.app, filePath, (result) => {
              encryptionByCallingWorker(
                this.worker,
                this.app,
                filePath,
                result
              );
            }).open();
          });
        });
      })
    );
    this.registerEvent(
      this.app.workspace.on("file-menu", (menu, file) => {
        if (file instanceof import_obsidian.TFolder) {
          return;
        }
        if (!file.path.endsWith(".bin")) {
          return;
        }
        menu.addItem((item) => {
          item.setTitle("Try to decrypt this file!").setIcon("key-square").onClick(async () => {
            const filePath = file.path;
            new AskingPasswordModal(this.app, filePath, (result) => {
              decryptionByCallingWorker(
                this.worker,
                this.app,
                filePath,
                result
              );
            }).open();
          });
        });
      })
    );
    this.registerEvent(
      this.app.workspace.on("editor-menu", (menu, editor, view) => {
        menu.addItem((item) => {
          item.setTitle("Generate encrypted version").setIcon("lock").onClick(async () => {
            const filePath = view.file.path;
            if (filePath.endsWith(".bin")) {
              return;
            }
            new AskingPasswordModal(this.app, filePath, (result) => {
              encryptionByCallingWorker(
                this.worker,
                this.app,
                filePath,
                result
              );
            }).open();
          });
        });
      })
    );
  }
  onunload() {
  }
};
var AskingPasswordModal = class extends import_obsidian.Modal {
  constructor(app, filePath, onSubmit) {
    super(app);
    this.onSubmit = onSubmit;
    this.password = "";
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.createEl("h1", { text: "What's your password for this file?" });
    new import_obsidian.Setting(contentEl).setName("Password").addText(
      (text) => text.onChange((value) => {
        this.password = value;
      })
    );
    new import_obsidian.Setting(contentEl).addButton(
      (btn) => btn.setButtonText("Submit").setCta().onClick(() => {
        this.close();
        this.onSubmit(this.password);
      })
    );
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};
